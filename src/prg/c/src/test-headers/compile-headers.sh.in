set -e
cd $(dirname "$0")
testdir=$(pwd)

# srcdir is set in the TEST directive but not otherwise. So running the
# run-tests be it as make check or make distcheck works. This is needed because
# the directory structure is different during make distcheck.
if [[ -z $srcdir ]]; then
	cliheaders="-I../../../../../../src/prg/c/inc"
	cliheaders+=" -I../../../../../../src/prg/c/inc-tmp"
	headers=$(find ../../../../../../src -name *.h)
else
	cliheaders="-I$srcdir/../../../../../src/prg/c/inc"
	cliheaders+=" -I$srcdir/../../../../../src/prg/c/inc-tmp"
	headers=$(find $srcdir/../../../../../src -name *.h)
fi
for headerpath in $headers; do
	header=${headerpath##*/}
	@CC@ $headerpath $cliheaders -Wall -Wextra -o $testdir/$header.gch
done
cd -

